<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="carousel.css">
    <script defer>
        // generate 5 pfp from randomuser.me
        const pfp_promises = [];
        for (let i = 0; i < 10; i++) {
            pfp_promises.push(fetch('https://randomuser.me/api/')
                .then(res => res.json())
                // .then(res => pfp.push(res.results[0].picture.large.toString()));
                .then(res => res.results[0].picture.thumbnail)
            );
        }

        document.addEventListener("DOMContentLoaded", () => {
            const images = document.querySelectorAll('img');
            const parentElement = images[0].parentElement;
            var center = [parentElement.clientWidth / 2, parentElement.clientHeight / 2];
            var rects = parentElement.getBoundingClientRect();

            const resizeObserver = new ResizeObserver(() => {
                center = [parentElement.clientWidth / 2, parentElement.clientHeight / 2];
                rects = parentElement.getBoundingClientRect();
                // console.log(rects);
            });
            resizeObserver.observe(parentElement);

            var size = 50;
            var radius = 1.3 * size * images.length / (2 * Math.PI);
            var angleVelocity = 0.05 / images.length;
            var mouseIn = false

            Promise.all(pfp_promises)
            .then(pfp => {
                for (let i = 0; i < images.length; i++) {
                    images[i].src = pfp[i];
                }
            });

            images.forEach(image => {
                image.style.width = `${size}px`;
                image.style.height = `${size}px`;
                image.onmouseenter = () => { mouseIn = true; }
                image.onmouseleave = () => { mouseIn = false; }
            });

            var angle = 0;
            var angleDt = Math.PI * 2 / images.length;
            setInterval(() => {
                if (mouseIn) return;
                angle += angleVelocity;
                images.forEach((image, index) => {
                    image.style.left = (Math.cos(angle + index * angleDt) * radius + center[0] - size / 2 + rects.left).toPrecision(4) + 'px';
                    image.style.top = (Math.sin(angle + index * angleDt) * radius + center[1] - size / 2 + rects.top).toPrecision(4) + 'px';
                });
                // console.log(parentElement.getBoundingClientRect());
                if (angle > 2 * Math.PI) {
                    angle = 0;
                }
            }, 20);
        })
    </script>
    <title>Carousel</title>
</head>

<body>
    <div class="carousel">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
        <img src="https://pbs.twimg.com/profile_images/640666088271839233/OTKlt5pC_400x400.jpg" alt="">
    </div>
</body>

</html>